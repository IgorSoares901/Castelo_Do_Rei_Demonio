<!DOCTYPE html>
<html>

<head>
   <title>Personagem controlável e animado</title>
   <script src="/Castelo_Do_Rei_Demonio/js/spritesheet.js"></script> 
   <script src="/Castelo_Do_Rei_Demonio/js/animacao.js"></script> 
   <script src="/Castelo_Do_Rei_Demonio/js/teclado.js"></script> 
   <script src="/Castelo_Do_Rei_Demonio/js/heroina.js"></script>
   <script src="/Castelo_Do_Rei_Demonio/js/colisor.js"></script>
   <script src="/Castelo_Do_Rei_Demonio/js/flecha.js"></script>
   <script src="/Castelo_Do_Rei_Demonio/js/arqueiro.js"></script>
   <script src="/Castelo_Do_Rei_Demonio/js/osso.js"></script>
   <script src="/Castelo_Do_Rei_Demonio/js/esqueleto.js"></script>
   <script src="/Castelo_Do_Rei_Demonio/js/minigodo.js"></script>
   <script src="/Castelo_Do_Rei_Demonio/js/chefe.js"></script>
   <script src="/Castelo_Do_Rei_Demonio/js/parallax.js"></script>
   <script src="/Castelo_Do_Rei_Demonio/js/Hud.js"></script>
   <link rel="stylesheet" href="styles.css">
</head>

<body>
   <canvas id="canvas_heroina" width="500" height="500"></canvas>
   <script>
      var canvas = document.getElementById('canvas_heroina');
      var context = canvas.getContext('2d');

      var teclado = new Teclado(document); 

      // cria a música ANTES da animação
      const musicaFundo = new Audio("mp3/musica-fundo.mp3");
      musicaFundo.loop = true;
      musicaFundo.volume = 0.4;
      var animacao = new Animacao(context, musicaFundo); 

       // botão de pausa é o enter
      document.addEventListener("keydown", function(e) {
         if (e.keyCode === 13) {
            animacao.togglePause();
         }
      });

      var imgMapa = new Image();
      imgMapa.src = 'imagem/mapa-principal-2 cortado.png'

      var imgNuvens = new Image();
      imgNuvens.src = 'imagem/floresta1  - Copia.jpg';

      var nuvensLayer3 = new Image();
      nuvensLayer3.src = 'imagem/nuvenslayer-3.png'

      var imgMuros = new Image();
      imgMuros.src = 'imagem/parede-porta copia.jpg'

      var imgSonic = new Image(); 
      imgSonic.src = 'imagem/kitsune-sprite-sheet.png';

      var imgArqueiro = new Image();
      imgArqueiro.src = "imagem/esqueleto-arqueiro.png";
      
      var imgEsqueleto = new Image();
      imgEsqueleto.src = "imagem/esqueleto.png";

      var imgGodo = new Image();
      imgGodo.src = "imagem/Chefe.png"

      var imgChefe = new Image();
      imgChefe.src = "imagem/Chefe.png";

      var sonic = new Sonic(context, teclado, imgSonic);
      sonic.x = -13; 
      sonic.y = 330; 
      animacao.novoSprite(sonic);
      window.heroina = sonic;

    // PARALLAX CONFIG
   var parallax = new Parallax(context);

   imgNuvens.onload = imgMuros.onload = function() {
      // aqui é o seguinte: adicionarcamada(imagem, velocidade, x, y, largura, altura)
      //(imagem, velocidade, posY = 0,posX = 0,ImgAltura=0,ImgLargura=0)
      // a velociedade * como o OFFSET do parallax, cuidado com o valor alto

      parallax.adicionarCamada(imgNuvens, 0.5, 0.5,1,1000); //ta mais lento
      parallax.adicionarCamada(nuvensLayer3, 1.50, 8,75);
      parallax.adicionarCamada(nuvensLayer3, 4.50, 75);
      //parallax.adicionarCamada(imgMuros, 0, 250, 0, 600,1000); //ta mais rapido
   };

   // Adiciona o parallax à animação
   animacao.inserirFundo({
      atualizar: function() {
         parallax.atualizar();
      },
      desenhar: function() {
         parallax.desenhar();
      }
   }, 0);



// colisor
var colisor = new Colisor(context, sonic);

// blocos ajustados pro canvas 5000 x 500 
// primeiros numeros são a posição direita e esquerda
// segundo numero é a posicão cima baixo
// terceiro numero é a largura
// quarto numero é a altura
colisor.adicionarBloco(0, 402, 5000, 50, "chao"); // chão
colisor.adicionarBloco(0, 0, 5, 500, "parede");  // extremidade inicial
colisor.adicionarBloco(4990, 0, 10, 500, "parede");  // extremidade final
colisor.adicionarBloco(55, 336, 82, 15, "plataforma"); // plataforma 1
colisor.adicionarBloco(137, 325, 207, 17, "plataforma"); // plataforma 2
colisor.adicionarBloco(232, 293, 17, 105, "parede");  // parede 1
colisor.adicionarBloco(345, 336, 95, 17, "plataforma"); // plataforma 3
colisor.adicionarBloco(1056, 336, 80, 17, "plataforma"); // plataforma 4
colisor.adicionarBloco(1137, 325, 207, 17, "plataforma"); // plataforma 5
colisor.adicionarBloco(1232, 293, 17, 105, "parede");  // parede 2
colisor.adicionarBloco(1345, 336, 95, 17, "plataforma"); // plataforma 6
colisor.adicionarBloco(1479, 310, 22, 5, "plataforma"); // plataforma mini 2 logo
colisor.adicionarBloco(1495, 300, 5, 5, "plataforma"); // plataforma mini 3
colisor.adicionarBloco(1500, 290, 30, 5, "plataforma"); // plataforma mini 4
colisor.adicionarBloco(1547, 290, 15, 5, "plataforma"); // plataforma mini 5
colisor.adicionarBloco(1547, 291, 1450, 2, "chao"); // chão de cima
colisor.adicionarBloco(3640, 327, 25, 80, "parede");  // parede 3
colisor.adicionarBloco(3738, 327, 25, 80, "parede");  // parede 4
colisor.adicionarBloco(3883, 327, 25, 80, "parede");  // parede 5
colisor.adicionarBloco(3968, 327, 25, 80, "parede");  // parede 6
colisor.adicionarBloco(4259, 374, 35, 30, "parede");  // escada 1
colisor.adicionarBloco(4290, 346, 35, 30, "parede");  // escada 2
colisor.adicionarBloco(4322, 316, 35, 30, "parede");  // escada 3
colisor.adicionarBloco(4352, 286, 35, 30, "parede");  // escada 4
colisor.adicionarBloco(4382, 256, 30, 30, "parede");  // escada 5
colisor.adicionarBloco(4382, 260, 650, 30, "chao"); // chão final
colisor.adicionarBloco(4500, 13, 10, 206, "parede");  // parede chefe
colisor.adicionarBloco(4536, 203, 47, 15, "plataforma"); // plataforma chefe
colisor.adicionarBloco(4619, 175, 47, 15, "plataforma"); // plataforma mini 2
colisor.adicionarBloco(4690, 174, 47, 15, "plataforma"); // plataforma mini 3
colisor.adicionarBloco(4780, 174, 47, 15, "plataforma"); // plataforma mini 4
colisor.adicionarBloco(4850, 174, 47, 15, "plataforma"); // plataforma mini 5
colisor.adicionarBloco(4915, 202, 47, 15, "plataforma"); // plataforma mini 6
colisor.adicionarBloco(4500, 13, 500, 10, "plataforma"); // teto chefe

var camera = {
  x: 0,
  y: 0,
  largura: canvas.width,
  altura: canvas.height,
  mundoLargura: 5000,
  mundoAltura: 500
}; // tive que criar a variavel da camera para o arqueiro saber da existencia dela

imgArqueiro.onload = function() {
   window.arqueiros = [];
   // tive que criar um array para arqueiros
   
   // tive que colocar a camera dentro de todos os arqueiros
   // arqueiro 1
  const arqueiro1 = new Arqueiro(context, imgArqueiro, animacao, camera);
  arqueiro1.x = 70; // posiçoes iniciais
  arqueiro1.y = 240;
  arqueiro1.colisor = colisor; // colisor do arqueiro
  animacao.novoSprite(arqueiro1);
  arqueiros.push(arqueiro1);
   
  //arqueiro 2
  const arqueiro2 = new Arqueiro(context, imgArqueiro, animacao, camera);
  arqueiro2.x = 270; // posiçoes iniciais
  arqueiro2.y = 227;
  arqueiro2.colisor = colisor; // colisor do arqueiro
  animacao.novoSprite(arqueiro2);
  arqueiros.push(arqueiro2);

  //arqueiro 3
  const arqueiro3 = new Arqueiro(context, imgArqueiro, animacao, camera);
  arqueiro3.x = 1160; // posiçoes iniciais
  arqueiro3.y = 227;
  arqueiro3.colisor = colisor; // colisor do arqueiro
  animacao.novoSprite(arqueiro3);
  arqueiros.push(arqueiro3);

  //arqueiro 4
  const arqueiro4 = new Arqueiro(context, imgArqueiro, animacao, camera);
  arqueiro4.x = 1360; // posiçoes iniciais
  arqueiro4.y = 240;
  arqueiro4.colisor = colisor; // colisor do arqueiro
  animacao.novoSprite(arqueiro4);
  arqueiros.push(arqueiro4);

  //arqueiro 5
  const arqueiro5 = new Arqueiro(context, imgArqueiro, animacao, camera);
  arqueiro5.x = 650; // posiçoes iniciais
  arqueiro5.y = 280;
  arqueiro5.colisor = colisor; // colisor do arqueiro
  animacao.novoSprite(arqueiro5);
  arqueiros.push(arqueiro5);

  //arqueiro 6
  const arqueiro6 = new Arqueiro(context, imgArqueiro, animacao, camera);
  arqueiro6.x = 950; // posiçoes iniciais
  arqueiro6.y = 280;
  arqueiro6.colisor = colisor; // colisor do arqueiro
  animacao.novoSprite(arqueiro6);
  arqueiros.push(arqueiro6);

};
 // chefe
imgChefe.onload = function() {
   window.chefe = []; // semppre precisa desse windows, ate la na heroina.js pra ela se tocar que os bichos existem
   const chefe1 = new Chefe(context, imgChefe, animacao, camera);
   chefe1.x = 4800; // posição inicial
   chefe1.y = 20;
   chefe1.colisor = colisor;
   animacao.novoSprite(chefe1);
   chefe.push(chefe1);
};



imgEsqueleto.onload = function() {
   window.esqueletos = [];
    // esqueleto 1
   const esqueleto1 = new Esqueleto(context, imgEsqueleto, animacao, camera);
   esqueleto1.x = 2000;
   esqueleto1.y = 0;
   esqueleto1.colisor = colisor;
   animacao.novoSprite(esqueleto1);
   esqueletos.push(esqueleto1);

    // esqueleto 2
   const esqueleto2 = new Esqueleto(context, imgEsqueleto, animacao, camera);
   esqueleto2.x = 1600;
   esqueleto2.y = 0;
   esqueleto2.colisor = colisor;
   animacao.novoSprite(esqueleto2);
   esqueletos.push(esqueleto2);

   // esqueleto 3
   const esqueleto3 = new Esqueleto(context, imgEsqueleto, animacao, camera);
   esqueleto3.x = 1800;
   esqueleto3.y = 0;
   esqueleto3.colisor = colisor;
   animacao.novoSprite(esqueleto3);
   esqueletos.push(esqueleto3); 

   //esqueleto 4
   const esqueleto4 = new Esqueleto(context, imgEsqueleto, animacao, camera);
   esqueleto4.x = 2300;
   esqueleto4.y = 0;
   esqueleto4.colisor = colisor;
   animacao.novoSprite(esqueleto4);
   esqueletos.push(esqueleto4);

   // esqueleto 5
   const esqueleto5 = new Esqueleto(context, imgEsqueleto, animacao, camera);
   esqueleto5.x = 2600;
   esqueleto5.y = 0;
   esqueleto5.colisor = colisor;
   animacao.novoSprite(esqueleto5);
   esqueletos.push(esqueleto5);

   // esqueleto 6
   const esqueleto6 = new Esqueleto(context, imgEsqueleto, animacao, camera);
   esqueleto6.x = 2850;
   esqueleto6.y = 0;
   esqueleto6.colisor = colisor;
   animacao.novoSprite(esqueleto6);
   esqueletos.push(esqueleto6);

   // esqueleto 7
   const esqueleto7 = new Esqueleto(context, imgEsqueleto, animacao, camera);
   esqueleto7.x = 3690;
   esqueleto7.y = 300;
   esqueleto7.colisor = colisor;
   animacao.novoSprite(esqueleto7);
   esqueletos.push(esqueleto7);

   // esqueleto 8
   const esqueleto8 = new Esqueleto(context, imgEsqueleto, animacao, camera);
   esqueleto8.x = 3819;
   esqueleto8.y = 300;
   esqueleto8.colisor = colisor;
   animacao.novoSprite(esqueleto8);
   esqueletos.push(esqueleto8);

   // esqueleto 9
   const esqueleto9 = new Esqueleto(context, imgEsqueleto, animacao, camera);
   esqueleto9.x = 3925;
   esqueleto9.y = 300;
   esqueleto9.colisor = colisor;
   animacao.novoSprite(esqueleto9);
   esqueletos.push(esqueleto9);
 };

 imgGodo.onload = function() {
   window.godos = []; // semppre precisa desse windows, ate la na heroina.js pra ela se tocar que os bichos existem
   //godo 1
   const godo1 = new Godo(context, imgGodo, animacao, camera);
   godo1.x = 2480; // posição inicial
   godo1.y = 300;
   godo1.colisor = colisor;
   animacao.novoSprite(godo1);
   godos.push(godo1);

    //godo 2
   const godo2 = new Godo(context, imgGodo, animacao, camera);
   godo2.x = 1700; // posição inicial
   godo2.y = 300;
   godo2.colisor = colisor;
   animacao.novoSprite(godo2);
   godos.push(godo2);

   // godo 3
   const godo3 = new Godo(context, imgGodo, animacao, camera);
   godo3.x = 2000; // posição inicial
   godo3.y = 300;
   godo3.colisor = colisor;
   animacao.novoSprite(godo3);
   godos.push(godo3);

   // godo 4
   const godo4 = new Godo(context, imgGodo, animacao, camera);
   godo4.x = 2800; // posição inicial
   godo4.y = 300;
   godo4.colisor = colisor;
   animacao.novoSprite(godo4);
   godos.push(godo4);

   
   // godo 5
   const godo5 = new Godo(context, imgGodo, animacao, camera);
   godo5.x = 3200; // posição inicial
   godo5.y = 300;
   godo5.colisor = colisor;
   animacao.novoSprite(godo5);
   godos.push(godo5);

   
};

 

// integrar o colisor à animação
animacao.novoSprite({
  atualizar: function () {
    colisor.checarColisoes();
    
  },
  desenhar: function () {
    colisor.desenhar(); // mostra blocos coloridos
  }
});

//colocar mapa como fundo
      var mapa = {
         context: context,
         imagem: imgMapa,
         x: 0,
         y: 19,
     
      //definir largura e altura do mapa pra ver se n da merda
        
         width: 5000,
         height: 500,

         atualizar: function() {
            // pro mapa n fazer nada
         },
         desenhar: function() {
            this.context.drawImage(this.imagem, this.x, this.y);
         }
      };

      window.hud = new HUD(context, sonic, animacao);

      animacao.inserirFundo(mapa,1);

   // nossa tela de carregamento e musica de fundo estão daqui para baixo
   let jogoIniciado = false;

   // desenha tela inicial
   function desenharTelaInicial() {
   context.fillStyle = "black";
   context.fillRect(0, 0, canvas.width, canvas.height);

   context.fillStyle = "white";
   context.font = "28px Arial";
   context.textAlign = "center";
   context.fillText("Castelo do Rei Demônio", canvas.width / 2, 180);

   context.font = "16px Arial";
   context.fillText("Pressione ENTER para começar", canvas.width / 2, 260);
   }

   function loopTelaInicial() {
   if (!jogoIniciado) {
      desenharTelaInicial();
      requestAnimationFrame(loopTelaInicial);
   }
   }
   loopTelaInicial();

   // abre o jogo ao apertar Enter — garante interação para tocar áudio
   document.addEventListener("keydown", function (e) {
   if (e.code === "Enter" && !jogoIniciado) {
      jogoIniciado = true;
      // tenta tocar; se o navegador bloquear, o usuário já interagiu e deve funcionar
      musicaFundo.play().catch(()=>{ /* ignorar se bloqueado */ });
      animacao.ligar();
   }
   });

   // IMPORTANTE: remova qualquer outro imgSonic.onload que chame animacao.ligar()
   // mantenha apenas a lógica acima para iniciar o jogo quando o jogador apertar Enter.
   imgSonic.onload = function() {
   // Pré-carregou a sprite, não liga o jogo aqui (a não ser que queira começar automaticamente)
   // animacao.ligar(); <-- REMOVER esta linha se você usar a tela inicial
   };
      </script>
   </body>

   </html>
